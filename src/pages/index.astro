---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog");
const recentPosts = allPosts
  .filter(
    (post) => post.data.title && post.data.title.toLowerCase() !== "readme",
  )
  .sort((a, b) => {
    const dateA = a.data.pubDate ? new Date(a.data.pubDate).valueOf() : 0;
    const dateB = b.data.pubDate ? new Date(b.data.pubDate).valueOf() : 0;
    return dateB - dateA;
  })
  .slice(0, 3);

// Get first post image for preload
const firstPostImage = recentPosts[0]?.data?.image?.url;
---

<Layout
  title="VashonMesh - Community Mesh Networks"
  floatingImages={true}
  maxWidth="1800px"
>
  <link
    slot="head"
    rel="preload"
    as="image"
    href="/logo/VashonMesh-md.webp"
    fetchpriority="high"
    type="image/webp"
    imagesrcset="/logo/VashonMesh-sm.webp 300w, /logo/VashonMesh-md.webp 600w, /logo/VashonMesh-lg.webp 1000w"
    imagesizes="(max-width: 768px) 200px, (max-width: 1279px) 280px, (max-width: 1919px) 420px, 500px"
  />
  {
    firstPostImage && (
      <link
        slot="head"
        rel="preload"
        as="image"
        href={firstPostImage}
        fetchpriority="high"
      />
    )
  }
  <main class="mx-auto px-4 max-w-450 pointer-events-none">
    <section class="hero">
      <img
        srcset="/logo/VashonMesh-sm.webp 300w, /logo/VashonMesh-md.webp 600w, /logo/VashonMesh-lg.webp 1000w"
        sizes="(max-width: 768px) 200px, (max-width: 1279px) 280px, (max-width: 1919px) 420px, 500px"
        src="/logo/VashonMesh-md.webp"
        alt="VashonMesh Logo"
        width="600"
        height="336"
        fetchpriority="high"
        class="thumbnail"
      />
      <h1 class="rubik-maps-regular">VashonMesh</h1>
      <p class="text-2xl mt-4 transition-transform duration-700 tagline">
        Connecting Vashon & Maury Islanders <br />...with Local Mesh Networks
      </p>
    </section>

    <section class="recent-news">
      <h2 class="text-3xl font-bold mb-6 text-(--text-primary)">Latest News</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {
          recentPosts.map((post, index) => (
            <a href={`/news/${post.id}`} class="news-card group">
              {post.data.image && (
                <div
                  class="image-tooltip-container"
                  data-caption={post.data.image.alt}
                  data-photographer={post.data.image.photographer}
                >
                  <div class="news-image">
                    <img
                      src={post.data.image.url}
                      alt={post.data.image.alt}
                      loading={index === 0 ? "eager" : "lazy"}
                      fetchpriority={index === 0 ? "high" : undefined}
                      width="400"
                      height="180"
                      class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                    />
                  </div>
                </div>
              )}
              <div class="news-content">
                <h3 class="text-lg font-bold mb-2 text--(--text-primary) group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                  {post.data.title}
                </h3>
                {post.data.pubDate && (
                  <time class="text-sm text-(--text-secondary) block mb-2">
                    {new Date(post.data.pubDate).toLocaleDateString("en-US", {
                      year: "numeric",
                      month: "long",
                      day: "numeric",
                    })}
                  </time>
                )}
                {post.data.description && (
                  <p class="text-sm text-(--text-secondary) line-clamp-3">
                    {post.data.description}
                  </p>
                )}
              </div>
            </a>
          ))
        }
      </div>
      <div class="text-center mt-6">
        <a
          href="/news"
          class="btn-primary inline-flex items-center justify-center px-6 pt-1 pb-1.75 text-white rounded-full transition-colors leading-none"
        >
          View All News â†’
        </a>
      </div>
    </section>

    <section
      class="cards-section grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"
    >
      <div class="card">
        <h2 class="text-[#667eea] text-2xl mt-0">
          LoRa = <span class="underline">Lo</span>ng <span class="underline"
            >Ra</span
          >nge Radio
        </h2>

        <p class="text-(--text-secondary) leading-relaxed">
          LoRa is a low-power, long-range foundational wireless communication
          technology.
          <ul>
            <li>
              A low-bandwidth alternative to Bluetooth, WiFi, GMRS and cellular
              technologies, LoRa reaches 2-10 kilometers to other LoRa devices -
              especially with good antennas and few obstructions.
            </li>
            <li>
              Repeaters easily extend this range, enabling community mesh
              networks - <strong
                >completely independent of cell towers or the internet!</strong
              >
            </li>
            <li>
              Introduced in 2015, LoRa is free to use, uses very low-power
              (under 1 amp), unlicensed frequency bands, and the basic chips
              cost ~$5. With a display, microprocessor & cases, consumer LoRa
              devices cost ~$30-100, easing adoption.
            </li>
          </ul>
        </p>
        <p>
          <img
            src="/site-imgs/LoRa-BWvsRange.png"
            alt="LoRa Bandwidth vs Range Comparison, courtesy of https://wifivitae.com/lora-vs-wifi-vs-bluetooth/"
          />
          <strong class="block text-center"
            >LoRa as compared with Wi-Fi, Cellular & Bluetooth</strong
          >
        </p>
        <div class="mt-4">
          <a
            href="https://en.wikipedia.org/wiki/LoRa"
            class="btn-primary inline-flex items-center justify-center px-6 pt-1 pb-1.5 text-white rounded-full transition-colors leading-none"
            >More about LoRa</a
          >
        </div>
      </div>

      <div class="card">
        <h2 class="text-[#667eea] text-2xl mt-0">
          Software Using LoRa Hardware
        </h2>
        <p class="text-(--text-secondary) leading-relaxed">
          Many software packages leverage cheap LoRa chips. A few popular
          options:
          <ul>
            <li>
              <strong
                ><a
                  href="https://lora-alliance.org/about-lorawan/"
                  target="_blank"
                  rel="noopener">LoRaWAN:</a
                ></strong
              > Great for monitoring sensors - on cows, birds, trucks, etc. These
              push data via the Internet to the cloud for analysis. Run by a huge
              conglomerate of companies, LoRaWAN is a closed ecosystem with expensive
              gateways and monthly fees, making it less ideal for community mesh networks.
            </li>
            <li>
              <strong
                ><a
                  href="https://www.thethingsnetwork.org/"
                  target="_blank"
                  rel="noopener">The Things Network:</a
                ></strong
              >
              refers to two things: the open-source software stack for LoRaWAN, and
              the global community network built on it. The software is free, but
              the network relies on volunteers to set up gateways and provide coverage.
              It's a popular alternative to commercial LoRaWAN providers, especially
              for hobbyists and community projects.
            </li>

            <li>
              <strong
                ><a
                  href="https://meshtastic.org/"
                  target="_blank"
                  rel="noopener">Meshtastic:</a
                ></strong
              > A free, open-source project using cheap LoRa devices to create community
              mesh networks. Very popular, it is great for smaller teams communicating
              directly with one another. With more participants the network can get
              flooded.
            </li>
            <li>
              <blockquote class="meshcore-focus">
                <img
                  src="/site-imgs/fingered.200x100.png"
                  alt="pointing finger"
                  class="pointing-finger"
                />
                <strong>MeshCore</strong> is what we are focusing on for Vashon &
                Maury Islands' network!
              </blockquote>

              <strong
                ><a
                  href="https://https://meshcore.co.uk/"
                  target="_blank"
                  rel="noopener">Meshcore:</a
                ></strong
              > An alternative to Meshtastic that uses the identical devices but a
              different network topology, one better for more traffic. It assumes
              the use of fixed repeaters(in hilltop locations with good antennas)
              to create a more efficient, scalable mesh network. Core firmware and
              protocol specifications are open source, but not many apps sitting on
              top.
            </li>
          </ul>

          <div class="mt-4">
            <a
              href="https://meshcore.net/"
              class="btn-primary inline-flex items-center justify-center px-6 pt-1 pb-1.5 text-white rounded-full transition-colors leading-none"
              >More about Meshcore</a
            >
          </div>
        </p>
      </div>

      <div class="card">
        <h2 class="text-[#667eea] text-2xl mt-0">Get on the Air</h2>
        <p class="text-(--text-secondary) leading-relaxed">
          Get started with a device and start chatting with your neighbors!

          <ol>
            <li>
              Get a device. For Vashon, devices advertised as working with
              Meshtastic will work for Meshcore once different software is
              loaded
              <p>UNDER CONSTRUCTION!</p>
              <ul>
                <li>
                  The <a
                    href="https://www.lorank.com/products/meshtastic-t-beam-v1-1"
                    target="_blank"
                    rel="noopener">T-Beam</a
                  > is a popular, affordable option with built-in GPS and good antenna
                  options.
                </li>
                <li>
                  The <a
                    href="https://www.lorank.com/products/meshtastic-t-lora32-v1-0"
                    target="_blank"
                    rel="noopener">T-Lora32</a
                  > is a more compact, lower-cost option without GPS.
                </li>
              </ul>
            </li>
          </ol>
        </p>

        <div class="card">
          <h2 class="text-[#667eea] text-2xl mt-0">Welcome</h2>
          <p class="text-(--text-secondary) leading-relaxed">
            Vashon has a small group of rebels interested in forming
            mesh-networks on Vashon & Maury Islands. First gathering in January
            2026, most of us are part of the island's radio club, <a
              href="W7VMI.org"
              target="_blank"
              rel="noopener">W7VMI</a
            >. We are experimenting with the technologies and figuring out
            strategies how best Meshcore can serve Vashon. (In the future we
            could also support a parallel Meshtastic mesh.) We are dedicated to
            helping islanders connect with MeshCore and related local area mesh
            networks.
          </p>
          <div class="mt-4">
            <a
              href="./vashon-mesh/"
              class="btn-primary inline-flex items-center justify-center px-6 pt-1 pb-1.5 text-white rounded-full transition-colors leading-none"
              >About Us</a
            >
          </div>
          <div class="mt-4">
            <a
              href="./mesh-tech/get-started"
              class="btn-primary inline-flex items-center justify-center px-6 pt-1 pb-1.5 text-white rounded-full transition-colors leading-none"
              >Get Started Guide
            </a>
          </div>
        </div>

        <div class="card">
          <h2 class="text-[#667eea] text-2xl mt-0">Get Involved</h2>
          <p class="text-(--text-secondary) leading-relaxed">
            Interested in joining or learning more about local mesh networks? We
            are all learning and experimenting. Join with us to learn more!
          </p>
          <div class="mt-4">
            <a
              href="/vashon-mesh/get-involved"
              class="btn-primary inline-flex items-center justify-center px-6 pt-1 pb-1.5 text-white rounded-full transition-colors leading-none"
            >
              How to Participate!
            </a>
          </div>
        </div>
      </div>
    </section>

    <style>
      /* Button styles for accessibility - solid background for proper contrast */
      .btn-primary {
        background-color: #4c1d95;
      }

      .btn-primary:hover {
        background-color: #3b0764;
      }

      /* Hero section with gradient background */
      .hero {
        text-align: center;
        padding: 1.5rem 1rem;
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.9) 0%,
          rgba(118, 75, 162, 0.9) 100%
        );
        color: white;
        border-radius: 12px;
        margin-bottom: 2.55rem;
        pointer-events: auto;
        position: relative;
        overflow: hidden;
        z-index: 250;
        display: grid;
        grid-template-columns: 1fr 1fr;
        align-items: center;
        gap: 2rem;
      }

      .hero h1,
      .hero .tagline {
        grid-column: 1;
        margin-left: 5%;
        margin-right: 0;
      }

      .hero .thumbnail {
        grid-column: 2;
        grid-row: 1 / 3;
        justify-self: center;
        align-self: center;
        margin: 0;
        width: 280px;
        height: auto;
        position: relative;
        z-index: 300;
      }

      /* XL screen scaling */
      @media (min-width: 1280px) {
        .hero .thumbnail {
          width: 420px;
        }

        .rubik-maps-regular {
          font-size: 144px;
        }

        .tagline {
          font-size: 2rem !important;
        }
      }

      @media (min-width: 1920px) {
        .hero .thumbnail {
          width: 500px;
        }

        .rubik-maps-regular {
          font-size: 168px;
        }

        .tagline {
          font-size: 2.5rem !important;
        }
      }

      /* Card styling with hover effects */
      .cards-section {
        pointer-events: none;
      }

      .card {
        background: rgba(255, 255, 255, 0.75);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 2rem;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        backdrop-filter: blur(10px);
        pointer-events: auto;
      }

      :global(.dark) .card {
        background: rgba(10, 10, 10, 0.75);
        border-color: rgba(55, 65, 81, 0.5);
      }

      .card:hover {
        transform: translateY(-4px) scale(1.05);
        box-shadow: 0 10px 20px 0 rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0 0 20px rgba(102, 126, 234, 0.6))
          drop-shadow(0 0 40px rgba(102, 126, 234, 0.4));
      }

      /* Recent news section */
      .recent-news {
        margin-bottom: 3rem;
        background: rgba(255, 255, 255, 0.75);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 2rem;
        backdrop-filter: blur(10px);
        pointer-events: auto;
      }

      :global(.dark) .recent-news {
        background: rgba(10, 10, 10, 0.75);
        border-color: rgba(55, 65, 81, 0.5);
      }

      .news-card {
        display: flex;
        flex-direction: column;
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        overflow: visible;
        transition: all 0.3s;
        text-decoration: none;
        pointer-events: auto;
      }

      :global(.dark) .news-card {
        background: rgba(26, 26, 46, 0.95);
      }

      .news-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 20px 0 rgba(0, 0, 0, 0.15);
      }

      .image-tooltip-container {
        position: relative;
        width: 100%;
      }

      .news-image {
        width: 100%;
        height: 180px;
        overflow: hidden;
        border-radius: 8px 8px 0 0;
      }

      /* Image tooltip */
      .image-tooltip-container::after {
        content: attr(data-caption);
        position: absolute;
        bottom: calc(100% + 10px);
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.92);
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 600;
        white-space: normal;
        max-width: 100%;
        width: max-content;
        text-align: center;
        opacity: 0;
        pointer-events: none;
        transition:
          opacity 0.3s ease,
          transform 0.3s ease;
        z-index: 10000;
        line-height: 1.3;
      }

      .image-tooltip-container[data-photographer]::after {
        content: attr(data-caption) "\A\A- " attr(data-photographer);
        white-space: pre-wrap;
        text-align: right;
        font-weight: 400;
      }

      .image-tooltip-container[data-photographer]::before {
        content: "";
        position: absolute;
        bottom: calc(100% + 10px);
        left: 50%;
        transform: translateX(-50%);
        width: max-content;
        max-width: 100%;
      }

      .news-card:hover .image-tooltip-container::after,
      .image-tooltip-container:hover::after {
        opacity: 1;
        transform: translateX(-50%) translateY(-4px);
      }

      :global(.dark) .image-tooltip-container::after {
        background-color: rgba(255, 255, 255, 0.95);
        color: #111827;
      }

      .news-content {
        padding: 1.25rem;
        flex: 1;
      }

      .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* Pointing finger for MeshCore blockquote */
      .meshcore-focus {
        position: relative;
      }

      .pointing-finger {
        position: absolute;
        top: -50px;
        right: -20px;
        width: 6rem;
        height: auto;
        opacity: 0.7;
        transform: rotate(-45deg);
        animation: point-bounce 4s ease-in-out infinite;
        filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
      }

      @keyframes point-bounce {
        0%,
        100% {
          transform: rotate(-45deg) translateY(0);
        }
        50% {
          transform: rotate(-45deg) translateY(-10px);
        }
      }

      @media (max-width: 768px) {
        .pointing-finger {
          width: 6rem;
          top: -30px;
          right: -15px;
        }
      }

      /* Custom font for title */
      .rubik-maps-regular {
        font-family: "Rubik Maps", system-ui;
        font-weight: 400;
        font-style: normal;
        font-size: 96px;
        transition:
          transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1),
          color 1.2s cubic-bezier(0.34, 1.56, 0.64, 1),
          text-shadow 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        margin: 0.5rem 0 0.25rem 0;
        line-height: 1;
        cursor: pointer;
        transform-origin: center center;
        display: inline-block;
      }

      .rubik-maps-regular:hover {
        transform: scale(1.05);
        color: #4a5fd8;
        text-shadow:
          0 0 20px rgba(102, 126, 234, 0.6),
          0 0 40px rgba(102, 126, 234, 0.4);
      }

      @media (min-width: 1280px) {
        .rubik-maps-regular:hover {
          transform: scale(1.08);
        }
      }

      /* Tagline styling */
      .tagline {
        display: block;
        transform-origin: center center;
        text-align: center;
        margin: 0 auto;
        color: rgba(255, 255, 255, 0.95);
      }

      :global(html:not(.dark)) .tagline {
        color: rgba(0, 0, 0, 0.85);
      }

      /* Thumbnail image hover and dark mode effects */
      .thumbnail {
        transition: all 0.8s ease;
        cursor: pointer;
        position: relative;
        z-index: 300;
      }

      :global(.dark) .thumbnail {
        filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
      }

      .thumbnail:hover {
        transform: scale(1.5);
        filter: hue-rotate(180deg);
        background: rgba(255, 255, 255, 0.1);
        z-index: 400;
      }

      @media (min-width: 1280px) {
        .thumbnail:hover {
          transform: scale(1.3);
        }
      }

      @media (max-width: 1000px) {
        .thumbnail:hover {
          transform: scale(1.5);
        }
      }

      :global(.dark) .thumbnail:hover {
        filter: hue-rotate(180deg)
          drop-shadow(0 0 12px rgba(255, 255, 255, 0.5));
        z-index: 400;
      }

      .thumbnail:hover ~ h1,
      .thumbnail:hover ~ .tagline {
        transform: scale(0.85);
      }

      /* Responsive layout adjustments */
      @media (max-width: 1000px) {
        .hero {
          grid-template-columns: 1fr;
          gap: 1rem;
        }

        .hero h1,
        .hero .tagline {
          grid-column: 1;
          margin-left: auto;
          margin-right: auto;
        }

        .hero .thumbnail {
          grid-column: 1;
          grid-row: auto;
          width: 250px !important;
        }

        .rubik-maps-regular {
          font-size: 56px;
        }

        .tagline {
          font-size: 1.3rem !important;
        }
      }

      @media (max-width: 768px) {
        .rubik-maps-regular {
          font-size: 48px;
        }

        .hero {
          padding: 2rem 1rem;
        }

        .hero .thumbnail {
          width: 200px !important;
        }

        .tagline {
          font-size: 1.2rem !important;
        }
      }

      @media (max-width: 480px) {
        .rubik-maps-regular {
          font-size: 36px;
        }

        .hero {
          padding: 1.5rem 1rem;
        }

        .hero .thumbnail {
          width: 150px !important;
        }

        .tagline {
          font-size: 1rem !important;
        }
      }
    </style>
  </main>
</Layout>
