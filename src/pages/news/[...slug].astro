---
import { getCollection, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<Layout 
  title={post.data.title || "News"}
>
  <article class="max-w-3xl mx-auto">
    {post.data.image && (
      <figure class="mb-8">
        <div class="aspect-video overflow-hidden rounded-lg">
          <img
            src={post.data.image.url}
            alt={post.data.image.alt}
            class="w-full h-full object-cover"
          />
        </div>
        {(post.data.image.alt || post.data.image.photographer) && (
          <figcaption class="mt-2 text-sm text-center text-[var(--text-secondary)] italic">
            {post.data.image.alt}
            {post.data.image.photographer && (
              <span class="block mt-1">
                Photo by {post.data.image.photographer}
              </span>
            )}
          </figcaption>
        )}
      </figure>
    )}
    
    <header class="mb-8">
      <h1 class="text-4xl md:text-5xl font-bold mb-4 text-[var(--text-primary)]">
        {post.data.title}
      </h1>
      
      <div class="flex items-center gap-4 text-[var(--text-secondary)] mb-4">
        {post.data.pubDate && (
          <time datetime={new Date(post.data.pubDate).toISOString()}>
            {new Date(post.data.pubDate).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}
          </time>
        )}
        {post.data.author && (
          <span>by {post.data.author}</span>
        )}
      </div>
      
      {post.data.description && (
        <p class="text-xl text-[var(--text-secondary)] italic">
          {post.data.description}
        </p>
      )}
      
      {post.data.tags && post.data.tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-4">
          {post.data.tags.map((tag) => (
            <a 
              href={`/news?tag=${encodeURIComponent(tag)}`}
              class="inline-block px-3 py-1 text-sm rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-800/40 transition-colors"
            >
              {tag}
            </a>
          ))}
        </div>
      )}
    </header>
    
    <div class="prose prose-lg dark:prose-invert max-w-none
                prose-headings:text-[var(--text-primary)]
                prose-p:text-[var(--text-secondary)]
                prose-a:text-blue-600 dark:prose-a:text-blue-400
                prose-strong:text-[var(--text-primary)]
                prose-code:text-[var(--text-primary)]
                prose-code:bg-gray-100 dark:prose-code:bg-gray-800
                prose-pre:bg-gray-100 dark:prose-pre:bg-gray-800
                prose-blockquote:border-l-blue-500
                prose-img:rounded-lg
                prose-figcaption:text-center
                prose-figcaption:text-sm
                prose-figcaption:italic
                prose-figcaption:text-[var(--text-secondary)]
                prose-figcaption:mt-2">
      <Content />
    </div>
    
    <footer class="mt-12 pt-8 border-t border-[var(--border-color)]">
      <a 
        href="/news" 
        class="inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:underline"
      >
        ‚Üê Back to all news
      </a>
    </footer>
  </article>
</Layout>

<style>
  /* Ensure embedded images in markdown content are responsive */
  article :global(img) {
    max-width: 100%;
    height: auto;
  }
  
  /* Style for figure elements in markdown content */
  article :global(figure) {
    margin: 2rem 0;
  }
  
  article :global(figcaption) {
    margin-top: 0.5rem;
    text-align: center;
    font-size: 0.875rem;
    font-style: italic;
    color: var(--text-secondary);
  }
  
  /* Support for images followed by emphasis text as captions */
  article :global(img + em) {
    display: block;
    margin-top: 0.5rem;
    text-align: center;
    font-size: 0.875rem;
    color: var(--text-secondary);
  }
</style>
